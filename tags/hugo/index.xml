<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Hugo on True Me </title>
    <link>https://zetaoyang.github.io/tags/hugo/</link>
    <description>Recent content in Hugo on True Me </description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>Zetao的小站</copyright>
    <lastBuildDate>Mon, 17 Oct 2016 09:44:23 +0800</lastBuildDate>
    <atom:link href="https://zetaoyang.github.io/tags/hugo/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>通过 Gitlab-cl 将 Hugo blog 自动部署至 GitHub </title>
      <link>https://zetaoyang.github.io/post/post-05/</link>
      <pubDate>Mon, 17 Oct 2016 09:44:23 +0800</pubDate>
      
      <guid>https://zetaoyang.github.io/post/post-05/</guid>
      <description>&lt;p&gt;教大家用 Hugo 建个人博客的文章太多了，这次我要介绍的是用 Gitlab-cl 自动部署( 持续集成 ) Hugo blog 到 Github Pages 上 (P.S. 当然前提是你必须有 Gitlab 账号哦 )，其核心就是一个配置文件&lt;code&gt;.gitlab-ci.yml&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# alpine linux 
#其包管理是 apk
image: alpine:3.4

before_script:
  - apk update 
  - apk add openssl &amp;amp;&amp;amp; apk add git &amp;amp;&amp;amp; apk add nodejs
  - npm install
  - wget https://github.com/spf13/hugo/releases/download/v0.16/hugo_0.16_linux-64bit.tgz
  - echo &amp;quot;37ee91ab3469afbf7602a091d466dfa5  hugo_0.16_linux-64bit.tgz&amp;quot; | md5sum -c
  - tar xf hugo_0.16_linux-64bit.tgz &amp;amp;&amp;amp; cp ./hugo /usr/bin
  - hugo version

pages:
  cache:
    paths:
    - node_modules/

  script:
  - git clone https://&amp;lt;your personal access tokens&amp;gt;@github.com/&amp;lt;your user name&amp;gt;/&amp;lt;your repository name&amp;gt; public
  - npm run build
  - cd ./public
  - git config user.name &amp;quot;&amp;lt;your user name&amp;gt;&amp;quot;
  - git config user.email &amp;quot;&amp;lt;your email&amp;gt;&amp;quot;
  - git config --global push.default simple
  - git add .
  - git commit -m &amp;quot;update site&amp;quot;
  - git push --set-upstream &amp;quot;https://&amp;lt;your personal access tokens&amp;gt;@github.com/&amp;lt;your user name&amp;gt;/&amp;lt;your repository name&amp;gt;&amp;quot;
  artifacts:
    paths:
    - public
  only:
  - master
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;我这里使用的是 Hugo 的 1.6 版本，当然你也可以安装当前最新的 1.7 版本。&lt;br /&gt;
由于我使用了&lt;code&gt;gulp&lt;/code&gt;压缩 html 和 js 文件，所以需要安装&lt;code&gt;nodejs&lt;/code&gt;。下面是&lt;code&gt;gulp&lt;/code&gt;的配置文件&lt;code&gt;gulpfile.babel.js&lt;/code&gt;的内容：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;import gulp from &#39;gulp&#39;
import htmlmin from &#39;gulp-htmlmin&#39;
import uglify from &#39;gulp-uglify&#39;
import runSequence from &#39;run-sequence&#39;
import shell from &#39;gulp-shell&#39;

gulp.task(&#39;hugo-build&#39;, shell.task([&#39;hugo&#39;]))

gulp.task(&#39;minify-html&#39;, () =&amp;gt; {
  return gulp.src(&#39;public/**/*.html&#39;)
    .pipe(htmlmin({
      collapseWhitespace: true,
      minifyCSS: true,
      minifyJS: true,
      removeComments: true,
      useShortDoctype: true,
    }))
    .pipe(gulp.dest(&#39;./public&#39;))
})

gulp.task(&#39;minify-js&#39;, () =&amp;gt; {
    return gulp.src(&#39;./public/**/*.js&#39;)
        .pipe(uglify())
        .pipe(gulp.dest(&#39;./public&#39;));
});

gulp.task(&#39;build&#39;, [&#39;hugo-build&#39;], (callback) =&amp;gt; {
  runSequence(&#39;minify-html&#39;,&#39;minify-js&#39;, callback)
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;这里用&lt;code&gt;gulp-shell&lt;/code&gt;这个包，执行&lt;code&gt;hugo&lt;/code&gt;这个命令。&lt;br /&gt;
package.json的内容:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
  &amp;quot;private&amp;quot;: true,
  &amp;quot;scripts&amp;quot;: {
    &amp;quot;build&amp;quot;: &amp;quot;gulp build&amp;quot;
  },
  &amp;quot;devDependencies&amp;quot;: {
    &amp;quot;babel-preset-es2015&amp;quot;: &amp;quot;^6.5.0&amp;quot;,
    &amp;quot;babel-register&amp;quot;: &amp;quot;^6.5.2&amp;quot;,
    &amp;quot;gulp&amp;quot;: &amp;quot;^3.9.1&amp;quot;,
    &amp;quot;gulp-cli&amp;quot;: &amp;quot;^1.2.1&amp;quot;,
    &amp;quot;gulp-htmlmin&amp;quot;: &amp;quot;^1.3.0&amp;quot;,
    &amp;quot;gulp-uglify&amp;quot;: &amp;quot;^2.0.0&amp;quot;,
    &amp;quot;gulp-shell&amp;quot;: &amp;quot;^0.5.2&amp;quot;,
    &amp;quot;run-sequence&amp;quot;: &amp;quot;^1.1.5&amp;quot;
  },
  &amp;quot;babel&amp;quot;: {
    &amp;quot;presets&amp;quot;: [
      &amp;quot;es2015&amp;quot;
    ]
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;由于&lt;code&gt;gulpfile.babel.js&lt;/code&gt;采用&lt;code&gt;ECMAScript 6&lt;/code&gt;标准，使用了最新的 JavaScript 语法，需要用&lt;code&gt;babeljs&lt;/code&gt;将其语法转化。&lt;br /&gt;
这些做完之后就可以在&lt;code&gt;.gitlab-ci.yml&lt;/code&gt;中用&lt;code&gt;npm run build&lt;/code&gt;部署你的 blog 了。&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>