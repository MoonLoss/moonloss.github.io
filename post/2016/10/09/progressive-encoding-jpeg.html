<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=1,minimum-scale=1,maximum-scale=1"><link rel="shortcut icon" href="/favicon.png"><link rel="apple-itouch-icon" href="/favicon.png"><style>img{max-width:100%}</style><script type="text/javascript">function onVisibilityChange(){document.hidden?(document.title="(/≧▽≦/)不要离开我！",clearTimeout(titleTime)):(document.title="True Me"+OriginTitile,titleTime=setTimeout(function(){document.title=OriginTitile},2e3))}var OriginTitile=document.title,titleTime;document.addEventListener("visibilitychange",onVisibilityChange)</script><script type="text/javascript">"serviceWorker"in navigator&&navigator.serviceWorker.register("/serviceworker.js").then(function(e){console.log("[Service Worker] Registered，rage is",e.scope)})["catch"](function(e){console.log("[Service Worker] Register failed:",e)})</script><style type="text/css">.box{display:none;position:fixed;right:10px;bottom:34px;height:30px;width:50px;text-align:center;padding-top:20px;background-color:#b7b7b7;opacity:.58;border-radius:25px;overflow:hidden;cursor:pointer}.box:hover:before{top:50%}.box:hover .box-in{visibility:hidden}.box:before{position:absolute;top:-50%;left:50%;transform:translate(-50%,-50%);width:40px;color:peru;font-weight:700}.box-in{visibility:visible;display:inline-block;height:20px;width:20px;border:3px solid #000;border-color:#fff transparent transparent #fff;transform:rotate(45deg)}</style><link rel="stylesheet" href="/bundle/index.css"><script type="text/javascript">var timeSinceLang={year:"年前",month:"个月前",day:"天前",hour:"小时前",minute:"分钟前",second:"秒前"},root=""</script><meta name="keywords" content="python3,jpeg,"><meta name="description" content="生成渐进式 jpeg"><title>生成渐进式 jpeg</title></head><body style="background-color:#fff"><article class="container"><header class="header-wrap"><nav><a class="index" href="/"><img class="logo" src="/images/avatar.png"> True Me</a><div onclick="darker()" style="background-image:url(/images/dark-brush.svg);background-size:contain;height:32px;width:32px;margin:1em 0;cursor:pointer"></div></nav><ul class="menu"><li class="menu-item"><a href="/archive.html">归档</a></li><li class="menu-item"><a href="/tag.html">标签</a></li><li class="menu-item"><a href="/blogroll.html">友链</a></li><li class="menu-item"><a href="/about.me.html">关于</a></li><li class="menu-item"><a href="/atom.xml"></a></li></ul></header><script type="text/javascript">function darker(){"rgb(255, 255, 255)"===sessionStorage.getItem("bg")?(sessionStorage.setItem("bg","rgb(6, 23, 37)"),sessionStorage.setItem("cc","#777")):null==sessionStorage.getItem("bg")?(sessionStorage.setItem("bg","rgb(6, 23, 37)"),sessionStorage.setItem("cc","#777")):"rgb(6, 23, 37)"===sessionStorage.getItem("bg")&&(sessionStorage.setItem("bg","rgb(255, 255, 255)"),sessionStorage.setItem("cc","#333")),document.body.style.backgroundColor=sessionStorage.getItem("bg"),document.body.style.color=sessionStorage.getItem("cc")}document.body.style.backgroundColor=sessionStorage.getItem("bg"),document.body.style.color=sessionStorage.getItem("cc")</script><article class="main article"><h1 class="title">生成渐进式 jpeg</h1><section class="info"><span class="avatar" style="background-image:url(/images/avatar.png)"></span> <a class="name" href="/about.me.html">Zetao Yang</a> <span class="date" data-time="1475981014"><span class="from"></span> 更新</span> <span class="tags"><a class="tag" href="/tag/python3/index.html">python3</a><a class="tag" href="/tag/jpeg/index.html">jpeg</a></span></section><article class="content"><p>用<code>python</code>实现了一个带参数的命令行将图片转换成<code>progressive encoding</code>(渐进式) JPEG 格式。<br>这里先贴出代码：</p><pre><code class="language-python">#! python3
import platform, sys, os
import getopt
from PIL import Image ,ImageFile

def isWindows():
    return 'Windows' in platform.system()
 
def isLinux():
    return 'Linux' in platform.system()

def usage():
    print (&quot;-h: This message.&quot;)
    print (&quot;-i [file]: the path of the target image file. &quot;)
    print (&quot;-o [filepath]: the path of the output. &quot;)
    print (&quot;EXAMPLES:&quot;)
    print (&quot;$py tojpeg.py -i /home/test.jpg - o /home&quot;)

def info():
    print (&quot;**************************************************&quot;)
    print (&quot;**|''''''''''''''''''''''''''''''''''''''''''''|**&quot;)
    print (&quot;**|convert images to progressive encoding JPEG |**&quot;)
    print (&quot;**|Version: 1 beta                             |**&quot;)
    print (&quot;**|By: zetao yang                              |**&quot;)
    print (&quot;**|Email: yangzetao2015[@] outlook             |**&quot;)
    print (&quot;**|https://zetaoyang.github.io                 |**&quot;)
    print (&quot;**|-                                           |**&quot;)
    print (&quot;**|Usage: $tojpeg -h                           |**&quot;)
    print (&quot;**|                                            |**&quot;)
    print (&quot;**|,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,|**&quot;)
    print (&quot;**************************************************&quot;)
    print (&quot;&quot;)

if(isWindows()):
   os.system(&quot;cls&quot;)
if(isLinux()):
   os.system(&quot;clear&quot;)

def main():
    info()
    try:
        #使用sys.argv[1:] 过滤掉第一个参数
        #（它是执行脚本的名字，不应算作参数的一部分）
        opts,args = getopt.getopt(sys.argv[1:],&quot;hi:o:&quot;, [&quot;help&quot;,&quot;input=&quot; ,&quot;output=&quot;])
    except getopt.GetoptError as err:
        print (err)
        sys.exit(2)

    if not opts and not args:
        usage()
        sys.exit()

    for opt, arg in opts:
        if opt in (&quot;-h&quot;,&quot;--help&quot;):
            usage()
            sys.exit()
        elif opt in (&quot;-i&quot;,&quot;--input&quot;):
            input_file = arg
        elif opt in (&quot;-o&quot;,&quot;--output&quot;):
            output_path = arg
        else:
            assert False, &quot;unhandled option&quot;

    try:
        img = Image.open(input_file)
        destination = output_path + &quot;/output.jpeg&quot;
        try:
            img.save(destination,&quot;JPEG&quot;,quality=80,optimize=True,progressive=True)
            print(&quot;conversion is ok.&quot;)
        except IOError:
            ImageFile.MAXBLOCK = img.size[0]*img.size[1]
            img.save(destination,&quot;JPEG&quot;,quality=80,optimize=True,progressive=True)
    except KeyboardInterrupt:
        print (&quot;\nWell i hope you had a good time.&quot;)
        
if __name__ == &quot;__main__&quot;:
    main()
</code></pre><p>最后可以用 <a href="https://github.com/pyinstaller/pyinstaller">pyinstaller</a> 打包分发了。</p></article><section class="author"><div class="avatar" style="background-image:url(/images/avatar.png)"></div><a class="name" href="/about.me.html">Zetao Yang</a><div class="intro">Thoughts and ideas.</div></section><section class="recommend"><section class="nav prev more"><div class="head">上篇文章</div><a class="link" href="/./post/2016/10/10/compile-linux-kernal.html">在 Alpine Linux 上编译 Linux0.11 内核</a></section><section class="nav next more"><div class="head">下篇文章</div><a class="link" href="/./post/2016/10/08/github-api.html">用 Github API 上传文件的方法</a></section></section><section id="disqus_thread"></section><script type="text/javascript">!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//zetao.disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script></article></article><script>!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-85037972-1","auto"),ga("send","pageview")</script><footer class="footer"><span class="copyright">True Me ©2016-<script type="text/javascript">document.write((new Date).getFullYear())</script>&nbsp;Zetao的小站 </span><span class="publish">本站使用<a href="https://creativecommons.org/licenses/by/4.0/deed.zh">「署名 4.0 国际」</a>创作共享协议</span></footer><div id="to-top" class="box"><div class="box-in"><div><div><script>window.onscroll=function(){var o=document.documentElement.scrollTop||document.body.scrollTop,e=document.documentElement.clientHeight||document.body.clientHeight;a.style.display=o>e?"block":"none"};var a=document.getElementById("to-top");a.onclick=function(){var o=500,e=10,n=document.documentElement.scrollTop||document.body.scrollTop,t=n/o*e,c=window.setInterval(function(){var o=document.documentElement.scrollTop||document.body.scrollTop;0==o&&window.clearInterval(c),document.documentElement.scrollTop=o-t,document.body.scrollTop=o-t},e);return!1}</script><script src="/bundle/index.js"></script></div></div></div></div></body></html>