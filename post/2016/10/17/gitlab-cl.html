<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=1,minimum-scale=1,maximum-scale=1"><link rel="shortcut icon" href="/favicon.png"><link rel="apple-itouch-icon" href="/favicon.png"><style>img{max-width:100%}</style><style type="text/css">.box{display:none;position:fixed;right:10px;bottom:34px;height:30px;width:50px;text-align:center;padding-top:20px;background-color:#b7b7b7;opacity:.58;border-radius:25px;overflow:hidden;cursor:pointer}.box:hover:before{top:50%}.box:hover .box-in{visibility:hidden}.box:before{position:absolute;top:-50%;left:50%;transform:translate(-50%,-50%);width:40px;color:peru;font-weight:700}.box-in{visibility:visible;display:inline-block;height:20px;width:20px;border:3px solid #000;border-color:#fff transparent transparent #fff;transform:rotate(45deg)}</style><link rel="stylesheet" href="/bundle/index.css"><script type="text/javascript">var timeSinceLang={year:"年前",month:"个月前",day:"天前",hour:"小时前",minute:"分钟前",second:"秒前"},root=""</script><meta name="keywords" content="blog,github,gitlab-cl,hugo,"><meta name="description" content="通过 Gitlab-cl 将 Hugo blog 自动部署至 GitHub "><title>通过 Gitlab-cl 将 Hugo blog 自动部署至 GitHub</title></head><body><article class="container"><header class="header-wrap"><a class="index" href="/"><img class="logo" src="/images/avatar.png"> True Me</a><ul class="menu"><li class="menu-item"><a href="/archive.html">归档</a></li><li class="menu-item"><a href="/tag.html">标签</a></li><li class="menu-item"><a href="/blogroll.html">友链</a></li><li class="menu-item"><a href="/about.me.html">关于</a></li><li class="menu-item"><a href="/atom.xml"></a></li></ul></header><article class="main article"><h1 class="title">通过 Gitlab-cl 将 Hugo blog 自动部署至 GitHub</h1><section class="info"><span class="avatar" style="background-image:url(/images/avatar.png)"></span> <a class="name" href="/about.me.html">Zetao Yang</a> <span class="date" data-time="1476668663"><span class="from"></span> 更新</span> <span class="tags"><a class="tag" href="/tag/blog/index.html">blog</a><a class="tag" href="/tag/github/index.html">github</a><a class="tag" href="/tag/gitlab-cl/index.html">gitlab-cl</a><a class="tag" href="/tag/hugo/index.html">hugo</a></span></section><article class="content"><p>教大家用 Hugo 建个人博客的文章太多了，这次我要介绍的是用 Gitlab-cl 自动部署( 持续集成 ) Hugo blog 到 Github Pages 上 (P.S. 当然前提是你必须有 Gitlab 账号哦 )，其核心就是一个配置文件<code>.gitlab-ci.yml</code>:</p><pre><code># alpine linux 
#其包管理是 apk
image: alpine:3.4

before_script:
  - apk update 
  - apk add openssl &amp;&amp; apk add git &amp;&amp; apk add nodejs
  - npm install
  - wget https://github.com/spf13/hugo/releases/download/v0.16/hugo_0.16_linux-64bit.tgz
  - echo &quot;37ee91ab3469afbf7602a091d466dfa5  hugo_0.16_linux-64bit.tgz&quot; | md5sum -c
  - tar xf hugo_0.16_linux-64bit.tgz &amp;&amp; cp ./hugo /usr/bin
  - hugo version

pages:
  cache:
    paths:
    - node_modules/

  script:
  - git clone https://&lt;your personal access tokens&gt;@github.com/&lt;your user name&gt;/&lt;your repository name&gt; public
  - npm run build
  - cd ./public
  - git config user.name &quot;&lt;your user name&gt;&quot;
  - git config user.email &quot;&lt;your email&gt;&quot;
  - git config --global push.default simple
  - git add .
  - git commit -m &quot;update site&quot;
  - git push --set-upstream &quot;https://&lt;your personal access tokens&gt;@github.com/&lt;your user name&gt;/&lt;your repository name&gt;&quot;
  artifacts:
    paths:
    - public
  only:
  - master
</code></pre><p>我这里使用的是 Hugo 的 1.6 版本，当然你也可以安装当前最新的 1.7 版本。<br>由于我使用了<code>gulp</code>压缩 html 和 js 文件，所以需要安装<code>nodejs</code>。下面是<code>gulp</code>的配置文件<code>gulpfile.babel.js</code>的内容：</p><pre><code>import gulp from 'gulp'
import htmlmin from 'gulp-htmlmin'
import uglify from 'gulp-uglify'
import runSequence from 'run-sequence'
import shell from 'gulp-shell'

gulp.task('hugo-build', shell.task(['hugo']))

gulp.task('minify-html', () =&gt; {
  return gulp.src('public/**/*.html')
    .pipe(htmlmin({
      collapseWhitespace: true,
      minifyCSS: true,
      minifyJS: true,
      removeComments: true,
      useShortDoctype: true,
    }))
    .pipe(gulp.dest('./public'))
})

gulp.task('minify-js', () =&gt; {
    return gulp.src('./public/**/*.js')
        .pipe(uglify())
        .pipe(gulp.dest('./public'));
});

gulp.task('build', ['hugo-build'], (callback) =&gt; {
  runSequence('minify-html','minify-js', callback)
})
</code></pre><p>这里用<code>gulp-shell</code>这个包，执行<code>hugo</code>这个命令。<br>package.json的内容:</p><pre><code>{
  &quot;private&quot;: true,
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;gulp build&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;babel-preset-es2015&quot;: &quot;^6.5.0&quot;,
    &quot;babel-register&quot;: &quot;^6.5.2&quot;,
    &quot;gulp&quot;: &quot;^3.9.1&quot;,
    &quot;gulp-cli&quot;: &quot;^1.2.1&quot;,
    &quot;gulp-htmlmin&quot;: &quot;^1.3.0&quot;,
    &quot;gulp-uglify&quot;: &quot;^2.0.0&quot;,
    &quot;gulp-shell&quot;: &quot;^0.5.2&quot;,
    &quot;run-sequence&quot;: &quot;^1.1.5&quot;
  },
  &quot;babel&quot;: {
    &quot;presets&quot;: [
      &quot;es2015&quot;
    ]
  }
}
</code></pre><p>由于<code>gulpfile.babel.js</code>采用<code>ECMAScript 6</code>标准，使用了最新的 JavaScript 语法，需要用<code>babeljs</code>将其语法转化。<br>这些做完之后就可以在<code>.gitlab-ci.yml</code>中用<code>npm run build</code>部署你的 blog 了。</p></article><section class="author"><div class="avatar" style="background-image:url(/images/avatar.png)"></div><a class="name" href="/about.me.html">Zetao Yang</a><div class="intro">Thoughts and ideas.</div></section><section class="recommend"><section class="nav next"><div class="head">下篇文章</div><a class="link" href="/./post/2016/10/10/compile-linux-kernal.html">在 Alpine Linux 上编译 Linux0.11 内核</a></section></section><section id="disqus_thread"></section><script type="text/javascript">!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//zetao.disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script></article></article><script>!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-85037972-1","auto"),ga("send","pageview")</script><footer class="footer"><span class="copyright">True Me ©<script type="text/javascript">document.write((new Date).getFullYear())</script>- Zetao的小站 </span><span class="publish">本站使用<a href="http://creativecommons.org/licenses/by/4.0/deed.zh">「署名 4.0 国际」</a>创作共享协议</span></footer><div id="to-top" class="box"><div class="box-in"><div><div><script>window.onscroll=function(){var o=document.documentElement.scrollTop||document.body.scrollTop,e=document.documentElement.clientHeight||document.body.clientHeight;a.style.display=o>e?"block":"none"};var a=document.getElementById("to-top");a.onclick=function(){var o=500,e=10,n=document.documentElement.scrollTop||document.body.scrollTop,t=n/o*e,c=window.setInterval(function(){var o=document.documentElement.scrollTop||document.body.scrollTop;0==o&&window.clearInterval(c),document.documentElement.scrollTop=o-t,document.body.scrollTop=o-t},e);return!1}</script><script src="/bundle/index.js"></script></div></div></div></div></body></html>